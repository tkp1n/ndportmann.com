<!DOCTYPE html><html lang="en" prefix="og: http://ogp.me/ns#"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/component---src-templates-post-template-js.b6f197430f783b3e67aa.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><style data-href="/app.8b1cc9920e75fff049f7.css">@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:300;src:local("Open Sans Light "),local("Open Sans-Light"),url(/static/open-sans-latin-300-60c866748ff15f5b347fdba64596b1b1.woff2) format("woff2"),url(/static/open-sans-latin-300-521d17bc9f3526c690e8ada6eee55bec.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:300;src:local("Open Sans Light italic"),local("Open Sans-Lightitalic"),url(/static/open-sans-latin-300italic-06bbd3188b34820cd83a0e0b3d0a6f57.woff2) format("woff2"),url(/static/open-sans-latin-300italic-8a648ff38ded89ea15916e84529d62d3.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:400;src:local("Open Sans Regular "),local("Open Sans-Regular"),url(/static/open-sans-latin-400-cffb686d7d2f4682df8342bd4d276e09.woff2) format("woff2"),url(/static/open-sans-latin-400-bf2d0783515b7d75c35bde69e01b3135.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:400;src:local("Open Sans Regular italic"),local("Open Sans-Regularitalic"),url(/static/open-sans-latin-400italic-987032ea5d57c93d8da215678eae3b86.woff2) format("woff2"),url(/static/open-sans-latin-400italic-db70d0b9cb27ada1a260a2b35e756b8b.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:600;src:local("Open Sans SemiBold "),local("Open Sans-SemiBold"),url(/static/open-sans-latin-600-223a277bd88d8a90c8cdf24cda0ad5f5.woff2) format("woff2"),url(/static/open-sans-latin-600-1cd5320f8937d337b61d5117cf9d7b28.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:600;src:local("Open Sans SemiBold italic"),local("Open Sans-SemiBolditalic"),url(/static/open-sans-latin-600italic-4950a7205f0b5cefe41fc03ac346e236.woff2) format("woff2"),url(/static/open-sans-latin-600italic-318ea1ada4102c0704a0637228dcad03.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:700;src:local("Open Sans Bold "),local("Open Sans-Bold"),url(/static/open-sans-latin-700-d08c09f2f169f4a6edbcf8b8d1636cb4.woff2) format("woff2"),url(/static/open-sans-latin-700-623e3205570002af47fc2b88f9335d19.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:700;src:local("Open Sans Bold italic"),local("Open Sans-Bolditalic"),url(/static/open-sans-latin-700italic-c02f5da6e82e1efe0b45841bfd49ce37.woff2) format("woff2"),url(/static/open-sans-latin-700italic-72e19cbb0e38c6773a7751156752cec4.woff) format("woff")}@font-face{font-family:Open Sans;font-style:normal;font-display:swap;font-weight:800;src:local("Open Sans ExtraBold "),local("Open Sans-ExtraBold"),url(/static/open-sans-latin-800-aaeffaf205b9bbb09920089a14dbe9e8.woff2) format("woff2"),url(/static/open-sans-latin-800-c6aa0c4a601fb6ac66f8253fa594dff5.woff) format("woff")}@font-face{font-family:Open Sans;font-style:italic;font-display:swap;font-weight:800;src:local("Open Sans ExtraBold italic"),local("Open Sans-ExtraBolditalic"),url(/static/open-sans-latin-800italic-6b3973ffe02bb6a8be0f8453506ec032.woff2) format("woff2"),url(/static/open-sans-latin-800italic-79b58175343190550489efe46a7f1138.woff) format("woff")}</style><meta name="generator" content="Gatsby 2.0.81"/><style id="__jsx-4192424678">.item.jsx-4192424678,.showItem.jsx-4192424678{background:transparent;-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
.item.jsx-4192424678 a,.showItem.jsx-4192424678 a{padding:10px;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
.item.jsx-4192424678 svg,.showItem.jsx-4192424678 svg{margin:0 5px 0 0;opacity:0.3;}
.itemList .hideItem{display:none;}
@media screen and (min-width:1024px){.item.jsx-4192424678 a{color:#3e3e3c;padding:10px;-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;border-radius:5px;}.homepage:not(.fixed) .item.jsx-4192424678 a{color:#ffffff;}.item.jsx-4192424678 a:hover{color:#709425;background:rgba(255,255,255,0.4);}.item.jsx-4192424678 svg{-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;}.item.jsx-4192424678:hover svg{fill:#709425;opacity:1;}.hero .item.jsx-4192424678:hover svg svg{fill:green;}.showItem.jsx-4192424678{display:none;}.hiddenItem.jsx-4192424678{text-align:left;padding:5px;}.hiddenItem.jsx-4192424678 a.inHiddenItem{color:#3e3e3c;}.hiddenItem.jsx-4192424678 a.inHiddenItem:hover{color:#709425;}}</style><style id="__jsx-1665230755">.menu.jsx-1665230755{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:#ffffff;bottom:0;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex-positive:1;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;left:0;max-height:50px;padding:0 10px;position:fixed;width:100%;z-index:1;-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;}
.itemList.jsx-1665230755{display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;list-style:none;margin:0;padding:0;position:relative;width:100%;}
@media screen and (max-width:1023px){.menu.jsx-1665230755::after{position:absolute;content:"";left:20px;right:20px;top:0;height:1px;background:#709425;}.menu.open.jsx-1665230755{padding:20px;}.homepage:not(.fixed) .menu.jsx-1665230755{bottom:-100px;}}
@media screen and (min-width:1024px){.menu.jsx-1665230755{border-top:none;background:transparent;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:relative;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;padding-left:50px;-webkit-transition:none;-webkit-transition:none;transition:none;}.itemList.jsx-1665230755{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;padding:0;}.hiddenItemList.jsx-1665230755{list-style:none;margin:0;position:absolute;background:#ffffff;border:1px solid #ecebea;top:48px;right:10px;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;padding:20px;border-radius:5px;border-top-right-radius:0;}.hiddenItemList.jsx-1665230755:after{content:"";background:#ffffff;z-index:10;top:-10px;right:-1px;width:44px;height:10px;position:absolute;border-left:1px solid #ecebea;border-right:1px solid #ecebea;}.homepage:not(.fixed) .hiddenItemList.jsx-1665230755{border:1px solid transparent;background:rgba(255,255,255,0.9);top:50px;}.homepage:not(.fixed) .hiddenItemList.jsx-1665230755:after{top:-11px;border-left:1px solid transparent;border-right:1px solid transparent;background:rgba(255,255,255,0.9);}.fixed .hiddenItemList.jsx-1665230755{top:44px;}}</style><style id="__jsx-768897745">.header.jsx-768897745{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#ffffff;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:80px;position:relative;top:0;width:100%;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
.header.jsx-768897745 a.logoType{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:"column";-webkit-flex-direction:"column";-ms-flex-direction:"column";flex-direction:"column";color:#3e3e3c;}
.header.jsx-768897745 a.logoType .logo.jsx-768897745{-ms-flex-negative:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}
.header.homepage.jsx-768897745{position:absolute;background-color:transparent;height:100px;;}
h1.jsx-768897745{font-size:1.35em;font-weight:400;margin:0 0 5px 0;}
h2.jsx-768897745{font-weight:400;font-size:.8em;-webkit-letter-spacing:0;-moz-letter-spacing:0;-ms-letter-spacing:0;letter-spacing:0;margin:0;}
.logo.jsx-768897745{border-radius:65% 75%;border:1px solid #eee;display:inline-block;height:44px;margin:0 20px 0 0;overflow:hidden;width:44px;-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;}
.homepage.jsx-768897745 .logo.jsx-768897745{height:60px;width:60px;}
.logo.jsx-768897745 img.jsx-768897745{width:100%;}
.sensor.jsx-768897745{display:block;position:absolute;bottom:0;z-index:1;left:0;right:0;height:1px;top:80px;}
@media screen and (min-width:600px){.header.jsx-768897745{padding:40px;}.header.homepage.jsx-768897745{height:100px;;}}
@media screen and (max-width:1023px){.header.homepage.jsx-768897745 .logo.jsx-768897745{border:none;}.header.homepage.jsx-768897745 a.logoType,.header.homepage.jsx-768897745 h1.jsx-768897745{color:#ffffff;}.header.homepage.jsx-768897745 h2.jsx-768897745{color:#dddbda;}}
@media screen and (min-width:1024px){.header.jsx-768897745{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:#ffffff;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:absolute;top:0;width:100%;-webkit-box-pack:justify;-ms-flex-pack:justify;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-transition:padding 0.5s;-webkit-transition:padding 0.5s;transition:padding 0.5s;}.header.fixed.jsx-768897745{height:50px;;background-color:#ffffff;left:0;padding:0 20px;position:fixed;top:0;width:100%;z-index:1;}.header.fixed.jsx-768897745 h1.jsx-768897745{margin:0 0 2px 0;}.header.fixed.jsx-768897745 h2.jsx-768897745{display:none;}.header.homepage.jsx-768897745:not(.fixed) a.logoType,.header.homepage.jsx-768897745:not(.fixed) h1.jsx-768897745{color:#ffffff;}.header.homepage.jsx-768897745:not(.fixed) h2.jsx-768897745{color:#dddbda;}.header.jsx-768897745 a.logoType{text-align:left;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-ms-flex-negative:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:auto;}.logo.jsx-768897745{margin:0 20px 0 0;}.fixed.jsx-768897745 .logo.jsx-768897745{height:36px;width:36px;}.header.homepage.jsx-768897745:not(.fixed) .logo.jsx-768897745{border:none;}h2.jsx-768897745{-webkit-animation-duration:0.5s;-webkit-animation-duration:0.5s;animation-duration:0.5s;-webkit-animation-name:h2Entry;-webkit-animation-name:h2Entry-jsx-768897745;animation-name:h2Entry-jsx-768897745;}@-webkit-keyframes h2Entry{from.jsx-768897745{opacity:0;}to.jsx-768897745{opacity:1;}}@-webkit-keyframes h2Entry-jsx-768897745{from{opacity:0;}to{opacity:1;}}@keyframes h2Entry-jsx-768897745{from{opacity:0;}to{opacity:1;}}}</style><style id="__jsx-2542452449">h1.jsx-2542452449{font-size:2.2em;margin:0 0 40px 0;-webkit-animation-name:headlineEntry;-webkit-animation-name:headlineEntry-jsx-2542452449;animation-name:headlineEntry-jsx-2542452449;-webkit-animation-duration:1s;-webkit-animation-duration:1s;animation-duration:1s;}
h1.jsx-2542452449 span{font-weight:400;display:block;font-size:0.5em;-webkit-letter-spacing:0;-moz-letter-spacing:0;-ms-letter-spacing:0;letter-spacing:0;margin:0 0 5px 0;}
h1.jsx-2542452449 svg{height:0.75em;fill:#709425;}
@-webkit-keyframes headlineEntry{from.jsx-2542452449{opacity:0.5;}to.jsx-2542452449{opacity:1;}}
@-webkit-keyframes headlineEntry-jsx-2542452449{from{opacity:0.5;}to{opacity:1;}}
@keyframes headlineEntry-jsx-2542452449{from{opacity:0.5;}to{opacity:1;}}
@media screen and (min-width:600px){h1.jsx-2542452449{font-size:calc(2em * 1.2);}}
@media screen and (min-width:1024px){h1.jsx-2542452449{font-size:calc(2em * 1.4);}}</style><style id="__jsx-2703193364">.meta.jsx-2703193364{display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;font-size:0.8em;margin:20px 0;background:transparent;}
.meta.jsx-2703193364 svg{fill:#709425;margin:0 5px 0 0;}
.meta.jsx-2703193364 span.jsx-2703193364{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;text-transform:uppercase;margin:5px 10px 5px 0;}
@media screen and (min-width:600px){.meta.jsx-2703193364{margin:calc(20px * 1.5) 0 20px;}}</style><style id="__jsx-1967274227">.bodytext.jsx-1967274227{-webkit-animation-name:bodytextEntry;-webkit-animation-name:bodytextEntry-jsx-1967274227;animation-name:bodytextEntry-jsx-1967274227;-webkit-animation-duration:1s;-webkit-animation-duration:1s;animation-duration:1s;}
.bodytext.jsx-1967274227 h2,.bodytext.jsx-1967274227 h3{margin:1.5em 0 1em;}
.bodytext.jsx-1967274227 h2{line-height:1.2;font-size:1.7em;}
.bodytext.jsx-1967274227 h3{font-size:1.35em;line-height:1.3;}
.bodytext.jsx-1967274227 p{font-size:1.1em;line-height:1.6;margin:0 0 1.5em;}
.bodytext.jsx-1967274227 ul{list-style:circle;margin:0 0 1.5em;padding:0 0 0 1.5em;}
.bodytext.jsx-1967274227 li{margin:0.7em 0;line-height:1.5;font-size:1.1em;}
.bodytext.jsx-1967274227 a:not(.ant-btn){font-weight:600;color:#709425;-webkit-text-decoration:underline;text-decoration:underline;}
.bodytext.jsx-1967274227 a.gatsby-resp-image-link{border:0;display:block;margin:2.5em 0;border-radius:10px;overflow:hidden;border:1px solid #ecebea;}
.bodytext.jsx-1967274227 .gatsby-highlight{margin:2.5em -20px;}
.bodytext.jsx-1967274227 .gatsby-highlight pre{border-radius:0;}
.bodytext.jsx-1967274227 p > code,.bodytext.jsx-1967274227 li > code{background:#ecebea;text-shadow:none;color:inherit;padding:0.1em 0.3em 0.2em;border-radius:undefined;}
.bodytext.jsx-1967274227 blockquote{padding-left:20px;border-left:5px solid #bbb;}
@-webkit-keyframes bodytextEntry{from.jsx-1967274227{opacity:0;}to.jsx-1967274227{opacity:1;}}
@-webkit-keyframes bodytextEntry-jsx-1967274227{from{opacity:0;}to{opacity:1;}}
@keyframes bodytextEntry-jsx-1967274227{from{opacity:0;}to{opacity:1;}}
@media screen and (min-width:600px){.bodytext.jsx-1967274227 .gatsby-highlight{margin:2.5em 0;}.bodytext.jsx-1967274227 .gatsby-highlight pre{border-radius:5px;}}</style><style id="__jsx-646394116">.author.jsx-646394116{margin:40px 0;padding:40px 0;border-top:1px solid #ecebea;border-bottom:1px solid #ecebea;}
.avatar.jsx-646394116{float:left;border-radius:65% 75%;border:1px solid #ecebea;display:inline-block;height:50px;margin:5px 20px 0 0;overflow:hidden;width:50px;}
.avatar.jsx-646394116 img.jsx-646394116{width:100%;}
.note.jsx-646394116{font-size:0.9em;line-height:1.6;}
@media screen and (min-width:600px){.author.jsx-646394116{display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.avatar.jsx-646394116{-webkit-box-flex:0;-ms-flex:0 0 auto;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;}}</style><style id="__jsx-3654911081">.links.jsx-3654911081{display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:0 20px 40px;border-bottom:1px solid #ecebea;margin:0 0 40px 0;}
.links.jsx-3654911081 a{display:-webkit-box;display:-ms-flexbox;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}
.links.jsx-3654911081 a:nth-child(2){margin:20px 0 0;}
.links.jsx-3654911081 svg{fill:orange;width:20px;height:20px;-ms-flex-negative:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-box-flex:0;-ms-flex-positive:0;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;margin:0 20px 0 0;}
h4.jsx-3654911081{font-weight:600;margin:0;font-size:1.1em;}
time.jsx-3654911081{color:#969492;display:block;font-weight:400;font-size:0.8em;margin-top:0.5em;}
@media screen and (min-width:1024px){.links.jsx-3654911081{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;-webkit-flex-direction:row-reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}.links.jsx-3654911081 a{-ms-flex-preferred-size:50%;-webkit-flex-basis:50%;-ms-flex-preferred-size:50%;flex-basis:50%;}.links.jsx-3654911081 a:nth-child(2){margin:0;}.links.jsx-3654911081 svg{-webkit-transition:all 0.5s;-webkit-transition:all 0.5s;transition:all 0.5s;margin:0 10px 0 0;}@media (hover:hover){.links.jsx-3654911081 a:hover svg{-webkit-transform:scale(1.5);-webkit-transform:scale(1.5);-ms-transform:scale(1.5);transform:scale(1.5);}}}</style><style id="__jsx-1766939654">.article.jsx-1766939654{padding:20px;margin:0 auto;}
@media screen and (min-width:600px){.article.jsx-1766939654{padding:calc(20px) calc(20px * 2);max-width:650px;}}
@media screen and (min-width:1024px){.article.jsx-1766939654{padding:calc(20px * 2 + 90px) 0 calc(20px * 2);max-width:700px;}}</style><style id="__jsx-2344609357">.footer.jsx-2344609357{background:#ffffff;padding:20px;padding-top:0;padding-bottom:120px;}
.footer.jsx-2344609357 ul{list-style:none;text-align:center;padding:0;}
.footer.jsx-2344609357 ul li{color:#969492;font-size:.8em;padding:2px 10px;position:relative;display:inline-block;}
.footer.jsx-2344609357 ul li::after{content:"•";position:absolute;right:calc(5px * -1);}
.footer.jsx-2344609357 ul li:last-child::after{content:"";}
@media screen and (min-width:1024px){.footer.jsx-2344609357{padding:0 1em 1.5em;}}</style><style id="__jsx-3017011455">main.jsx-3017011455{min-height:80vh;}</style><style id="__jsx-2888242338">html{-webkit-box-sizing:border-box;box-sizing:border-box;}
*,*:after,*:before{-webkit-box-sizing:inherit;box-sizing:inherit;margin:0;padding:0;}
th,td{padding:0.5em;text-align:left;border-bottom:1px solid #ddd;}
table{margin-bottom:1.5em;}
body{font-family:Arial, sans-serif;;}
h1,h2,h3{font-weight:400;line-height:1.1;-webkit-letter-spacing:-0.03em;-moz-letter-spacing:-0.03em;-ms-letter-spacing:-0.03em;letter-spacing:-0.03em;margin:0;}
h1{-webkit-letter-spacing:-0.04em;-moz-letter-spacing:-0.04em;-ms-letter-spacing:-0.04em;letter-spacing:-0.04em;}
p{margin:0;}
strong{font-weight:400;}
a{-webkit-text-decoration:none;text-decoration:none;color:#666;}
main{width:auto;display:block;}</style><title data-react-helmet="true">Passing Context with Spring WebFlux (Part I) - NDPortmann - .NET / Java / Security</title><meta data-react-helmet="true" name="description" content="A blog about C#, .NET, Java, InfoSec and Cryptography."/><meta data-react-helmet="true" property="og:url" content="https://ndportmann.com/passing-context-with-spring-webflux/"/><meta data-react-helmet="true" property="og:title" content="Passing Context with Spring WebFlux (Part I) - NDPortmann - .NET / Java / Security"/><meta data-react-helmet="true" property="og:description" content="A blog about C#, .NET, Java, InfoSec and Cryptography."/><meta data-react-helmet="true" property="og:image" content="https://ndportmann.com/static/bff675e664834c0b5731c75046b1d565/ada8c/rawpixel-678089-unsplash.jpg"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="unsafepin"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#666"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-3752a44c74d2719f9a5a.js"/><link as="script" rel="preload" href="/app-2217dd5556ba23224b63.js"/><link as="script" rel="preload" href="/0-1ec89199b094b9bab5df.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-7828f72df583fec8a107.js"/><link as="fetch" rel="preload" href="/static/d/7/path---passing-context-with-spring-webflux-a-6-a-68e-bjYlDwCRZReeWN1w2s95Lpoy2c.json" crossOrigin="use-credentials"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#D0E0D8"/><meta name="apple-mobile-web-app-title" content="Lazywill"/><link rel="apple-touch-icon" href="/icons/apple-icon-57x57.png" sizes="57x57"/><link rel="apple-touch-icon" href="/icons/apple-icon-60x60.png" sizes="60x60"/><link rel="apple-touch-icon" href="/icons/apple-icon-72x72.png" sizes="72x72"/><link rel="apple-touch-icon" href="/icons/apple-icon-76x76.png" sizes="76x76"/><link rel="apple-touch-icon" href="/icons/apple-icon-114x114.png" sizes="114x114"/><link rel="apple-touch-icon" href="/icons/apple-icon-120x120.png" sizes="120x120"/><link rel="apple-touch-icon" href="/icons/apple-icon-144x144.png" sizes="144x144"/><link rel="apple-touch-icon" href="/icons/apple-icon-152x152.png" sizes="152x152"/><link rel="apple-touch-icon" href="/icons/apple-icon-180x180.png" sizes="180x180"/><link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><header class="jsx-768897745 header  "><a class="logoType" href="/"><div class="jsx-768897745 logo"><img src="https://secure.gravatar.com/avatar/8af55ced886e9ae05831f3fafdf0e495" alt="NDPortmann - .NET / Java / Security" class="jsx-768897745"/></div><div class="jsx-768897745 type"><h1 class="jsx-768897745">Nicolas Portmann</h1><h2 class="jsx-768897745">C#, .NET, Java, InfoSec, Cryptography</h2></div></a><nav rel="js-menu" class="jsx-1665230755 menu "><ul class="jsx-1665230755 itemList"><li class="jsx-4192424678 item"><a class="" data-slug="/" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em"><path d="M488 312.7V456c0 13.3-10.7 24-24 24H348c-6.6 0-12-5.4-12-12V356c0-6.6-5.4-12-12-12h-72c-6.6 0-12 5.4-12 12v112c0 6.6-5.4 12-12 12H112c-13.3 0-24-10.7-24-24V312.7c0-3.6 1.6-7 4.4-9.3l188-154.8c4.4-3.6 10.8-3.6 15.3 0l188 154.8c2.7 2.3 4.3 5.7 4.3 9.3zm83.6-60.9L488 182.9V44.4c0-6.6-5.4-12-12-12h-56c-6.6 0-12 5.4-12 12V117l-89.5-73.7c-17.7-14.6-43.3-14.6-61 0L4.4 251.8c-5.1 4.2-5.8 11.8-1.6 16.9l25.5 31c4.2 5.1 11.8 5.8 16.9 1.6l235.2-193.7c4.4-3.6 10.8-3.6 15.3 0l235.2 193.7c5.1 4.2 12.7 3.5 16.9-1.6l25.5-31c4.2-5.2 3.4-12.7-1.7-16.9z"></path></svg> <!-- -->Home</a></li><li class="jsx-4192424678 item"><a class="" data-slug="/category/" href="/category/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg> <!-- -->Categories</a></li><li class="jsx-4192424678 item"><a class="" data-slug="/about/" href="/about/"> <!-- -->About</a></li></ul></nav></header><div class="jsx-768897745 sensor"></div><main class="jsx-3017011455 jsx-2888242338"><article class="jsx-1766939654 article"><header><h1 class="jsx-2542452449">Passing Context with Spring WebFlux (Part I)</h1><p class="jsx-2703193364 meta"><span class="jsx-2703193364"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" size="18" height="18" width="18"><path d="M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"></path></svg> <!-- -->2018-01-04</span><span class="jsx-2703193364"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" size="18" height="18" width="18"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></svg> <!-- -->nicolas portmann</span><span class="jsx-2703193364"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" size="18" height="18" width="18"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 0 1 0 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg><a href="/category/Java">Java</a></span></p></header><div class="jsx-1967274227 bodytext"><p>With traditional Jakarta EE (Java EE) or Spring projects, we utilize <a href="https://logback.qos.ch/manual/mdc.html">MDCs (Mapped Diagnostic Context)</a> - a feature from SLF4J - to enrich logs with contextual data. Such contextual data might include but is not limited to the following:</p>
<ul>
<li>Request ID,</li>
<li>DNS name of the hardware involved in processing the request,</li>
<li>The ID of the client initiating the request</li>
</ul>
<p>In a microservices environment, this information is then typically passed to all services involved in handling a specific client request. Although <a href="https://tools.ietf.org/html/rfc6648">deprecated</a> we examine, how to best pass context information between services as HTTP non-standard <code class="language-text">X-</code> headers. We also investigate in the second part of this post, how to use constructs such as MDCs in a reactive environment, where <code class="language-text">ThreadLocal</code>s cannot be used to store context. </p>
<p>The solution to the latter is a variation of <a href="https://simonbasle.github.io/2018/02/contextual-logging-with-reactor-context-and-mdc/">this excellent idea by Simon Basle</a>. I suggest you skim over it before reading the second part, a link to which you can find at the very bottom of this page.</p>
<h2>Handling headers with WebFilters</h2>
<p><code class="language-text">WebFilter</code>s function much like their <a href="https://www.oracle.com/technetwork/java/filters-137243.html">servelt counterparts</a>, but using Spring and Reactor specific APIs. </p>
<p>To start, we start we create a Spring <code class="language-text">@Component</code> implementing the <code class="language-text">WebFilter</code> interface. In this component, we register two methods, one for copying the MDCs passed as request headers to the context, a second one to copy the context to the response. Context, in this case, refers to a <a href="https://projectreactor.io/docs/core/release/reference/#context">well documented</a> concept to handle orthogonal concerns with Reactor (one of the building blocks of Spring WebFulx). </p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MdcHeaderFilter</span> <span class="token keyword">implements</span> <span class="token class-name">WebFilter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@NonNull</span>
    <span class="token keyword">public</span> Mono<span class="token generics function"><span class="token punctuation">&lt;</span>Void<span class="token punctuation">></span></span> <span class="token function">filter</span><span class="token punctuation">(</span>
        <span class="token annotation punctuation">@NonNull</span> ServerWebExchange ex<span class="token punctuation">,</span> 
        <span class="token annotation punctuation">@NonNull</span> WebFilterChain chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ex<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beforeCommit</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token function">addContextToHttpResponseHeaders</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span>
                    ctx <span class="token operator">-</span><span class="token operator">></span> <span class="token function">addRequestHeadersToContext</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Although it might not look like it, <code class="language-text">addRequestHeaderstToContext</code> gets invoked first (in fact before any <code class="language-text">@Controller</code>s) and <code class="language-text">addContextToHttpResponseHeaders</code> is called after the request has been processed by the respective controller. There is one caveat, we should address right away to avoid unpleasant surprises in the future. The <code class="language-text">beforeCommit</code> callback gets executed only if the request handlers leave no exception uncaught. As context in logs is especially important, if something goes wrong, we shall make sure, that no exception goes uncaught (I had to learn this the hard way…). There are many solutions to solve this; we’ll go with a <code class="language-text">@ControllerAdvice</code> capable of improvement for now:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@ExceptionHandler</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> Mono<span class="token operator">&lt;</span>ResponseEntity<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">></span></span><span class="token operator">></span> <span class="token function">gottaCatchEmAll</span><span class="token punctuation">(</span>
        Exception e<span class="token punctuation">,</span> 
        ServerWebExchange ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> Mono<span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>
            ResponseEntity
                <span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>With that out of the way, we take a look at the two callbacks from the <code class="language-text">WebFilter</code>. <code class="language-text">addRequestHeaderstToContext</code> inspects all headers of every request passed through it and extracts all headers starting with <code class="language-text">X-MDC-</code> and populates a Map with them. Before returning, the Map is added to the context passed as a parameter to the method. A mutable map is now stored within the otherwise immutable <code class="language-text">Context</code>, allowing us to quite easily add additional context information in the handlers as we shall see soon. </p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String MDC_HEADER_PREFIX <span class="token operator">=</span> <span class="token string">"X-MDC-"</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String CONTEXT_MAP <span class="token operator">=</span> <span class="token string">"context-map"</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> Context <span class="token function">addRequestHeadersToContext</span><span class="token punctuation">(</span>
        <span class="token keyword">final</span> ServerHttpRequest request<span class="token punctuation">,</span>
        <span class="token keyword">final</span> Context context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">final</span> Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">></span></span> contextMap <span class="token operator">=</span> request
            <span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toSingleValueMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> x<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>MDC_HEADER_PREFIX<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                    <span class="token function">toMap</span><span class="token punctuation">(</span>v <span class="token operator">-</span><span class="token operator">></span> v<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>MDC_HEADER_PREFIX<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            Map<span class="token punctuation">.</span>Entry<span class="token operator">:</span><span class="token operator">:</span>getValue
                    <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>CONTEXT_MAP<span class="token punctuation">,</span> contextMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The purpose of <code class="language-text">addContextToHttpResponseHeaders</code> is the exact opposite. It prefixes all entries in the context map with <code class="language-text">X-MDC-</code> and adds them to the response headers.</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">private</span> Mono<span class="token generics function"><span class="token punctuation">&lt;</span>Void<span class="token punctuation">></span></span> <span class="token function">addContextToHttpResponseHeaders</span><span class="token punctuation">(</span>
        <span class="token keyword">final</span> ServerHttpResponse res<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> Mono<span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doOnNext</span><span class="token punctuation">(</span>ctx <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ctx<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>CONTEXT_MAP<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> HttpHeaders headers <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>&lt;Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">></span></span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>CONTEXT_MAP<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>MDC_HEADER_PREFIX <span class="token operator">+</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<blockquote>
<p>An aside: In Spring 5.0.4 this was not working as expected which motivated me to open my first <a href="https://jira.spring.io/browse/SPR-16597">issue</a> with Spring. Luckily it was quickly addressed and fixed in Spring 5.0.5.</p>
</blockquote>
<h2>Summary</h2>
<p>With a simple demo controller, we shall now verify whether our filter works as expected. </p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Collector<span class="token operator">&lt;</span>CharSequence<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">,</span> String<span class="token operator">></span> COLLECTOR
            <span class="token operator">=</span> Collectors<span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">","</span> <span class="token operator">+</span> System<span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"["</span><span class="token punctuation">,</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Mono<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">></span></span> <span class="token function">apply</span><span class="token punctuation">(</span>String prefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Mono<span class="token punctuation">.</span><span class="token function">subscriberContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> x<span class="token punctuation">.</span>&lt;Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">></span></span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>CONTEXT_MAP<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> prefix <span class="token operator">+</span> x<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>kv <span class="token operator">-</span><span class="token operator">></span> kv<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> kv<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>COLLECTOR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/demo"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> Mono<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">></span></span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Mono<span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">"The context contains: "</span> <span class="token operator">+</span> System<span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>DemoController<span class="token operator">:</span><span class="token operator">:</span>apply<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Above REST controller responds to requests to <code class="language-text">/demo</code> with the content of the current context. Let’s see, how it works out.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> -v -H <span class="token string">"X-MDC-FOO: BAR"</span> localhost:8080/demo
<span class="token operator">></span> GET /demo HTTP/1.1
<span class="token operator">></span> Host: localhost:8080
<span class="token operator">></span> User-Agent: curl/7.58.0
<span class="token operator">></span> Accept: */*
<span class="token operator">></span> X-MDC-FOO: BAR
<span class="token operator">></span>
<span class="token operator">&lt;</span> HTTP/1.1 200 OK
<span class="token operator">&lt;</span> Content-Type: text/plain<span class="token punctuation">;</span>charset<span class="token operator">=</span>UTF-8
<span class="token operator">&lt;</span> Content-Length: 34
<span class="token operator">&lt;</span> X-MDC-FOO: BAR
<span class="token operator">&lt;</span>
The context contains:
<span class="token punctuation">[</span>FOO: BAR<span class="token punctuation">]</span></code></pre></div>
<p>You might have noticed, that the context is returned as response headers. Very well and just as expected. In part two, we investigate how we can add more information to the context, and leverage it in the application logs.</p>
<blockquote>
<p>The entire project (including part two) is on <a href="https://github.com/tkp1n/mdc-webflux">github</a> for your reference.</p>
</blockquote></div><footer><div>Loading...</div><div class="jsx-646394116 author"><div class="jsx-646394116 avatar"><img src="https://secure.gravatar.com/avatar/8af55ced886e9ae05831f3fafdf0e495" alt="NDPortmann - .NET / Java / Security" class="jsx-646394116"/></div><div class="jsx-646394116 note"><p><strong>Nicolas Portmann</strong> Software developer working on the back-end of the swiss cashless payment platform. Writing code for hardware security modules (Embedded C) and bridging the gap between low level network protocols and high level business applications (in Java/C#).</p></div></div><div class="jsx-3654911081 links"><a href="/logging-with-context-in-spring-webflux/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg><h4 class="jsx-3654911081">Logging with Context in Spring WebFlux (Part II)<!-- --> <time class="jsx-3654911081">2018-01-05<!-- --> </time></h4></a><a href="/system-threading-channels/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em"><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></svg><h4 class="jsx-3654911081">Exploring System.Threading.Channels<!-- --> <time class="jsx-3654911081">2018-01-03</time></h4></a></div></footer></article></main><footer class="jsx-2344609357 footer"><ul>
<li>content by <a href="https://ndportmann.com">Nicolas Portmann</a></li>
<li>photos by <a href="https://unsplash.com">unsplash.com</a></li>
<li>graphic by <a href="http://www.freepik.com">starline / Freepik</a></li>
<li>theme by <a href="http://greglobinski.com">Greg Lobinski</a></li>
</ul></footer></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-template-js","jsonName":"passing-context-with-spring-webflux-a6a","path":"/passing-context-with-spring-webflux/"};window.dataPath="7/path---passing-context-with-spring-webflux-a-6-a-68e-bjYlDwCRZReeWN1w2s95Lpoy2c";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.8b1cc9920e75fff049f7.css","/app-2217dd5556ba23224b63.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-259b6ecbd1e38adb68b3.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-247c63988908fcf28a31.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js.b6f197430f783b3e67aa.css","/component---src-templates-post-template-js-7828f72df583fec8a107.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-d601735e356fb974c6c4.js"],"component---src-pages-404-js":["/component---src-pages-404-js-14d22c07ddf79bc0cef9.js"],"component---src-pages-category-js":["/component---src-pages-category-js-f6b169d904e460cc5788.js"],"component---src-pages-index-js":["/component---src-pages-index-js-4a2daf7d475c1e09abc1.js"],"pages-manifest":["/pages-manifest-7f80502d99c4a4b3ce1d.js"]};/*]]>*/</script><script src="/component---src-templates-post-template-js-7828f72df583fec8a107.js" async=""></script><script src="/0-1ec89199b094b9bab5df.js" async=""></script><script src="/app-2217dd5556ba23224b63.js" async=""></script><script src="/webpack-runtime-3752a44c74d2719f9a5a.js" async=""></script></body></html>